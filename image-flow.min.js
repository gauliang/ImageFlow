+function(t){if(!window.jQuery)throw new Error("ImageFlow 依赖 jQuery ！");window&&window.jQuery&&t(window,window.jQuery)}(function(t,i){var a="1.0.0",e=function(){this.version=a},s=function(t){this.data={timer:null,colWidth:0,currentRow:0,rowHeight:0,row:0,col:0,scale:0,colpos:[],articles:[],articlesTemp:[],source:null,target:null},this.options={scope:"",scale:"16:9",colspan:1.85,rowspan:.7,gutter:10,tpl:'<a href="{link}"></a><div class="info"><h3>{title}</h3><p>{desc}</p><span>作者：{author}</span></div>',screen:{breakpoints:[768,960,1200,1600],typeList:["xs","sm","md","lg","hg"]},grid:{hg:{col:6,row:2},lg:{col:5,row:2},md:{col:4,row:3},sm:{col:3,row:4},xs:{col:2,row:5}}}};s.prototype.init=function(t){var a=this;i.extend(this.options,t),this.data.row=this.options.grid[this.scrrenType()].row,this.data.col=this.options.grid[this.scrrenType()].col;for(var e=0;e<this.data.row;e++)this.data.colpos.push(0);this.data.source=i(this.options.scope),this.data.colWidth=Math.round((this.data.source.width()-(this.data.col-1)*this.options.gutter)/this.data.col),this.data.scale=parseInt(this.options.scale.split(":")[1])/parseInt(this.options.scale.split(":")[0]),this.data.rowHeight=this.data.colWidth*this.data.scale,this.data.target=i(document.createElement("div")),this.data.target.addClass("viewport"),this.data.target.css({height:this.data.row*this.data.rowHeight+this.options.gutter*(this.data.row-1)}),this.data.source.append(this.data.target),i.each(this.data.source.find(".col"),function(t,e){a.data.articles.push({title:i(e).attr("data-title"),image:i(e).attr("src"),desc:i(e).attr("data-desc"),author:i(e).attr("data-author"),link:i(e).attr("data-link")})}),i(window).resize(function(){a.onResize()}),a.recursion(this.data.articles)},s.prototype.scrrenType=function(){for(var t=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,i=0;i<this.options.screen.breakpoints.length;i++)if(t<this.options.screen.breakpoints[i])return this.options.screen.typeList[i];return"hg"},s.prototype.onResize=function(){var t=this;this.data.timer?(clearTimeout(this.data.timer),this.data.timer=setTimeout(function(){t.flush()},300)):this.data.timer=setTimeout(function(){t.flush()},300)},s.prototype.flush=function(){this.data.target.remove(),this.data.currentRow=0,this.data.colpos=[],this.data.articles=new Array,this.data.articlesTemp=[],this.init(this.scope)},s.prototype.insertTempArticle=function(){var t=[];if(this.data.articlesTemp.length>0){for(var i=0;i<this.data.articlesTemp.length;i++)"inserted"!=this.data.articlesTemp[i].iteminfo.flag&&t.push(this.data.articlesTemp[i]);this.data.articlesTemp=t}if(this.data.articlesTemp.length>0)for(var i=0;i<this.data.articlesTemp.length;i++)if(this.data.articlesTemp[i].index=i,this.insertElement(this.data.articlesTemp[i])>=this.data.col)return},s.prototype.recursion=function(t){var a=this;if(t.length>0){var e=t.shift();a.insertTempArticle();var s=this.options.tpl.replace(/\{(.+?)\}/g,function(t){return e[t.substring(1,t.length-1)]}),o={},r=i(new Image);r.bind("load",function(){o.naturalWidth=r[0].naturalWidth,o.naturalHeight=r[0].naturalHeight,o.image=r,o.wrap=s,o.iteminfo=e,a.insertElement(o)<a.data.col&&a.recursion(t)}),r.attr({src:e.image})}},s.prototype.insertElement=function(t){var a=this.data.currentRow,e=this.data.colpos[a],s=t.naturalWidth/t.naturalHeight,o=0,r=0,h=i(document.createElement("div")).addClass("col").append(t.wrap);if(h.append(t.image),t.naturalWidth/t.naturalHeight>this.options.colspan)if(this.data.col-(e+2)>=0){this.data.target.append();o=2*this.data.colWidth+this.options.gutter,r=this.data.rowHeight,this.imageFix(t.image,s,o,r),h.css({width:o,height:r,left:this.data.colpos[a]*this.data.colWidth+this.data.colpos[a]*this.options.gutter,top:a*this.data.rowHeight+a*this.options.gutter}),this.data.target.append(h),"temp"==t.iteminfo.flag&&(this.data.articlesTemp[t.index].iteminfo.flag="inserted"),this.data.colpos[a]+=2,this.data.currentRow=this.getMinimumRow()}else"temp"!=t.iteminfo.flag&&(t.iteminfo.flag="temp",t.iteminfo.failed=0,this.data.articlesTemp.push(t)),t.iteminfo.failed>10&&this.data.articlesTemp.shift(),t.iteminfo.failed++;else t.naturalWidth/t.naturalHeight<this.options.rowspan?this.data.row-(a+2)>=0&&this.data.colpos[a]>=this.data.colpos[a+1]&&this.data.col-(e+1)>=0?(o=this.data.colWidth,r=2*this.data.rowHeight+this.options.gutter,this.imageFix(t.image,s,o,r),h.css({width:o,height:r,left:this.data.colpos[a]*this.data.colWidth+this.data.colpos[a]*this.options.gutter,top:a*this.data.rowHeight+a*this.options.gutter}),this.data.target.append(h),"temp"==t.iteminfo.flag&&(this.data.articlesTemp[t.index].iteminfo.flag="inserted"),this.data.colpos[a]++,this.data.colpos[a+1]++,this.data.currentRow=this.getMinimumRow()):("temp"!=t.iteminfo.flag&&(t.iteminfo.flag="temp",t.iteminfo.failed=0,this.data.articlesTemp.push(t)),t.iteminfo.failed>10&&this.data.articlesTemp.shift(),t.iteminfo.failed++):this.data.col-(e+1)>=0&&(o=this.data.colWidth,r=this.data.rowHeight,this.imageFix(t.image,s,o,r),h.css({width:o,height:r,left:this.data.colpos[a]*this.data.colWidth+this.data.colpos[a]*this.options.gutter,top:a*this.data.rowHeight+a*this.options.gutter}),this.data.target.append(h),this.data.colpos[a]++,this.data.currentRow=this.getMinimumRow());return this.data.colpos[this.getMinimumRow()]},s.prototype.imageFix=function(t,i,a,e){a/e>=i?t.css({width:a,top:0-(a/i-e)/2}):t.css({height:e,left:0-(e*i-a)/2})},s.prototype.getMinimumRow=function(){for(var t=0,i=this.data.colpos,a=1;a<i.length;a++)i[a]<i[t]&&(t=a);return t},e.prototype.create=function(t,a){i.extend(a||{},{scope:t}),(new s).init(a)},window.ImageFlow=new e});